<ui-modal-drawer size="large" [title]="group?.name || ''" (closed)="group = undefined" #modal>
  <ng-template>
    <h2>Informations</h2>
    <mat-form-field appearance="fill">
      <mat-label>Nom</mat-label>
      <input [(ngModel)]="groupName" (keyup.enter)="renameGroup()" matInput />
      <mat-hint>Appuyez sur entrer pour enregistrer</mat-hint>
    </mat-form-field>
    <h2>Membres</h2>
    <nz-button-group>
      <button (click)="search.open()" nz-button nzType="primary" nz-tooltip="Ajouter un membre au groupe">
        <span nz-icon nzType="plus" nzTheme="outline"></span>
      </button>
      <ng-container *ngIf="selection.length as selectionCount">
        <nz-badge [nzCount]="selectionCount">
          <button
            [nz-tooltip]="selectionCount > 1 ? 'Supprimer les membres sélectionnés' : 'Supprimer le membre sélectionné'"
            nz-button
            nzDanger
            nz-popconfirm
            nzOkText="Supprimer"
            nzOkType="danger"
            [nzPopconfirmTitle]="removeGuard"
            [nzPopconfirmPlacement]="'bottom'"
            [nzPopconfirmOverlayStyle]="{ 'max-width': '300px' }"
            (nzOnConfirm)="removeMembers()"
          >
            <div nz-icon nzType="close" nzTheme="outline"></div>
          </button>
        </nz-badge>
      </ng-container>
    </nz-button-group>
    <user-search-bar #searchbar [(ngModel)]="members" [autoSelect]="true" [filters]="filters" />
    <user-table
      [total]="searchbar.total"
      [users]="members"
      [loading]="searchbar.searching"
      [selectable]="true"
      [(filters)]="filters"
      [(ngModel)]="selection"
    />
  </ng-template>
  <ng-template> </ng-template>
</ui-modal-drawer>

<user-search-modal
  #search
  [title]="'Ajouter un membre au groupe ' + group?.name"
  [okTitle]="'Ajouter'"
  [excludes]="excludes"
  (closed)="addMembers($event)"
/>

<ng-template #removeGuard>
  <strong>
    @if (selection.length > 1) { Voulez-vous vraiment retirer les membres sélectionnés du groupe? } @else { Voulez-vous
    vraiment retirer le membre sélectionné du groupe? } </strong
  ><br /><br />
  <p>
    Cette action est irréversible. En supprimant un membre du groupe, vous lui retirez également tous les droits
    associés au groupe comme l'accès à des cours et activités.
  </p>
</ng-template>
